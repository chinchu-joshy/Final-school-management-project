<div class="container mt-5 ">
   <div class="col ml-5 mt-5">
       <h3 style="color: rgb(7, 7, 80);" class="teacher-payhead">Upload Photos...</h3>
   </div>


<input type="file" name="fileUpload" id="fileUpload" class=" teacher-payhead">
<div id="uploadedImage" style="width: 300px; height:300px;" class="ml-5"></div>
<hr>
<div  style="width: 300px; height:300px;" class="ml-5">
    <img id="croppedImage" style="width: 300px; height:300px;">

    <button type="submit"  id="cropButton" >crop</button>
    
<div class="col-md-8">
<div id="cropResult"></div>
</div>
   </div> 
   
</div>




<script>
    const uploadImageDiv=document.getElementById('uploadedImage');
    const fileUpload=document.getElementById('fileUpload');
    fileUpload.addEventListener('change',getImage,false);
    let cropper = null;
    const cropButton=document.getElementById('cropButton');
    cropButton.addEventListener('click',cropImage);
    let myGreatImage=null;
        const croppedImage=document.getElementById('croppedImage');
    function getImage(){
        console.log("images",this.files[0]);
        const imageToProcess=this.files[0];
        let newImg =new Image(imageToProcess.width,imageToProcess.height);
        newImg.src=URL.createObjectURL(imageToProcess);
        newImg.id="myGreatImage";
        uploadImageDiv.style.border="4px solid black";
        uploadImageDiv.appendChild(newImg);
        myGreatImage=document.getElementById('myGreatImage')
        processImage();
    }
    function processImage(){
      
        cropper=new Cropper(myGreatImage,{
            aspectRatio:16/9,
            crop(event){
                console.log(event)
                
                const canvas=this.cropper.getCroppedCanvas();
                croppedImage.src=canvas.toDataURL('image/png');
            }
        })
    }
    function cropImage(){
       let imgUrl=cropper.getCroppedCanvas().toDataURL();
       
       cropper.getCroppedCanvas().toBlob(function(blob){
        url = URL.createObjectURL(blob);
       
        var reader = new FileReader();
			reader.readAsDataURL(blob);
            reader.onloadend = function(){
				var base64data = reader.result;
				console.log(base64data)
                $.ajax({
					url:'/upload-img',
					method:'POST',
					data:{
                       
                        image:base64data
                        
                        },
					success:function(data)
					{
						alert('Uploaded successfully')
                        location.href='/addimage'
					}
				});
				
			};
       })
        const val=imgUrl.split(',')[1]
        
        const img=document.createElement('img');
        img.src=imgUrl;
        document.getElementById('cropResult').appendChild(img)

    }
     
</script>
